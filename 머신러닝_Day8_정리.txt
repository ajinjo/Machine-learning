비지도 학습

결과값이 없이 입력값만 주고 학습을 시켜서 유사성을 파악하게 하는 방식 (정답 없음)
데이터의 숨겸진 특징이나 구조를 발견하는 데 사용
정답이 없는 입력 데이터만 이용하기 때문에
입력값 자체의 특성과 분포만을 파악해서 그룹핑하는 군집화에 주로 사용

비지도 학습 유형
- 비지도 변환
- 군집 (clustering)

군집 (Clustering)
- 데이터를 비슷한 것끼리 그룹으로 묶는 작업
- K-평균
- DBSCAN


군집화
데이터 포인트들을 별개의 군집으로 그룹화하는 것
유사성이 높은 데이터들을 동일한 그룹으로 분류하고
서로 다른 군집들이 상이성을 가지도록 그굽화

K-평균 (K-Means)
군집화에서 가장 일반적으로 사용되는 알고리즘
군집 중심점(centroid)이라는 특정한 임의 지점을 선택해서
해당 중심에 가까운 포인트들을 선택하는 군집화 기법
K-평균 동작 원리

군집 중심점은 선택된 포인트의 평균 지점으로 이동하고
이동된 중심점에서 다시 가까운 포인트를 선택,
다신 중심점을 평균 지점으로 이동하는 프로세스를 반복적으로 수행
모든 데이터 포인트에서 더 이상 중심점의 이동이 없을 경우에 반복을 멈추고
해당 중심점에 속하는 데이터 포인트들을 군집화하는 기법


K-평균의 장점과 단점

장점
알고리즘이 쉽고 간결
대용량 데이터에도 활용 가능
일반적인 군집화에서 가장 많이 활용되는 알고리즘

단점
속성의 개수가 많을 경우 군집화 정확도가 떨어짐
(PCA로 차원 축소 적용 필요할 수도 있음)
반복 횟수가 많을 경우 수행 시간 느려짐
이상치 데이터에 취약
몇 개의 군집(cluster)을 선택해야 할지 가이드하기 어려움


군집화 알고리즘 테스트를 위한 데이터 생성
사이킷런의 대표적인 군집화용 데이터 생성기 사용
- make_blobs() 


군집화 평가
비지도 학습의 특성상
어떠한 지표도 정확하게 성능을 평가하기 어렵지만
대표적 군집화 성능 평가 방법으로 실루엣 분석 이용

실루엣 분석 (Silhouette Analysis)
- 각 군집 간의 거리가 얼마나 효율적으로 분리되어 있는지 분석
- 효율적 분리 의미
    - 다른 군집과의 거리는 떨어져 있고
    - 동일 군집끼리의 데이터는 서로 가깝게 잘 뭉쳐있다는 의미
- 군집화가 잘 될수록 개별 군집은 비슷한 정도의 여유 공간을 가지고 떨어져 있음
- 실루엣 계수(Silhouette coefficient) 기반
    - 개별 데이터가 가지는 군집화 지표로
    - 해당 데이터가 같은 군집 내의 데이터와 얼마나 가깝게 군집화되어 있고
    - 다른 군집에 있는 데이터와는 얼마나 멀리 분리되어 있는지를 나타내는 지표


특정 데이터 포인트의 실루엣 계수
- 해당 데이터 포인트와 같은 군집 내에 있는
- 다른 데이터 포인트와의 거리를
- 평균한 값 : a(i)
- 해당 포인트가 속하지 않은 군집 중
- 가장 가까운 군집과의 평균 거리 : b(i)
- -1에서 1 사이의 값
- 1로 가까워질수록 근처의 군집과 더 멀리 떨어져 있다는 것이고
- 0에 가까울수록 근처의 군집과 가까워진다는 것
- -값은 아예 다른 군집에 데이터 포인트가 할당되었음을 의미

실루엣 분석을 위한 사이킷런 메서드

silhouette_samples()
- 인자 : 피처 데이터, 레이블 값
- 반환값 : 각 데이터 포인트의 실루엣 계수
    
silhouette_score()
- 인자 : 피처 데이터, 레이블 값
- 반환값 : 전체 데이터의 실루엣 계수 평균 값
    - 이 값이 높을수록 군집화가 어느 정도 잘 됐다고 판단
    - 하지만 무조건 높다고 군집화가 잘 됐다고는 판단할 수는 없음

기타 군집화 알고리즘
평균 이동 (Mean Shift)
- K-평균과 유사하지만
- 거리 중심이 아니라 데이터가 모여 있는 밀도가 가장 높은 쪽으로
- 군집 중심점을 이동하면서 군집화 수행

- 일반 업무 기반의 정형 데이터 셋보다는
- 컴퓬터 비전 영역에서 이미지나 영상 데이터에서
- 특정 개체를 구분하거나 움직임을 추적하는데
- 뛰어난 역할을 수행

- K-평균과 유사하게 중심을 군집의 중심으로 지속적으로 움직이면서 군집화 수행
- 데이터의 분포도를 이용해 군집 중심점을 찾고
- 중심을 데이터가 모여 있는 밀도가 가장 높은 곳으로 이동시킴
- K-평균 : 중심에 소속된 데이터의 평균 거리 중심으로 이동

GMM(Gaussian Mixture Model)
- 군집화를 적용하고자 하는 데이터가
- 여러 개의 가우시난 분포(정규 분포)를 가진 데이터 집합들이 섞여서 생성된 것이라는
- 가정하에 군집화를 수행하는 방식
- 전체 데이터 셋에서 서로 다른 정규 분포 형태를 추출해서
- 다른 정규 분포를 가진 데이터 셋을 각각 군집화하는 것
- 장점 : K-평균보다 유연하게 다양한 데이터 셋에 잘 적용 가능
- 단점 : 군집화를 위한 수행 시간이 오래 걸림
    
K-평균과 비교
- K-평균 : 원형 번위에서 군집화 수행
- 데이터 셋이 원형의 번위를 가질수록 군집화 효율은 더 높아짐

DBSCAN(Density Based Spatial Clustering)
- 밀도 기반의 군집화의 대표적인 알고리즘
- 특정 공간 내에 데이터 밀도 차이를 기반 알고리즘으로 하고 있어서
- 데이터의 분포가 기하하적으로 복잡한 데이터 셋에서도 효과적인 군집화 가능
- K-평균, 평균 이동, GMM으로는 효과적인 군집화를 수행하기 어려운 경우 사용




군집화 실습 - 고객 세그먼테이션 (Custoemr Segmentation)¶


고객 세그먼테이션 군집화 과정
데이터 세트 로딩과 데이터 클린징

반품이나 CustomerID가 Null인 데이터는 제외
영국 이외 국가의 데이터는 제외
RFM 기반 데이터 가공

구매금액 생성
고객 기준으로 Recency, Frequency, Monetary 가공
RFM 기반 고객 세그먼테이션

Recency, Frequency, Monetary 값의 분포도 확인
K-Means로 군집화 수행 후에 실루엣 계수 평가
K-Means 군집화 후에 실루엣 계수 및 군집을 시각화
로그 변환 후 재 시각화



왜곡된 데이터에 로그 변환 수행
특정 소매점의 대량 주문 구매 때문에
데이터 분포가 심하게 왜곡되어 있어서
군집수를 계속 늘려봐야
이 큰 군집만 지속적으로 분리하게 되기에
의미 없는 군집화 결과로 이어지게 됨
그래서 먼저 로그 변환을 통해서
데이터 셋의 왜곡 정도를 낮추고
K-평균 알고리즘 적용할 필요가 있음


# 결과
# 실루엣 스코어는 로그 변환하기 전보다 떨어짐
# 그러나 실루엣 스코어의 절대치가 절대적으로 중요한 것은 아니고
# 어떻게 개별 군집이 더 균일하게 나뉠 수 있는지가 더 중요
